<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Signup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

</head>

<body class="bg-gray-100 h-screen flex items-center justify-center">
    <!-- Login / Signup Card -->
    <div class="w-full max-w-md bg-white p-8 rounded-lg shadow-lg">
        <!-- Tab Navigation -->
        <div class="flex justify-around mb-6">
            <button id="login-tab"
                class="w-full py-2 bg-blue-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">Login</button>
            <button id="signup-tab"
                class="w-full py-2 bg-gray-200 text-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">Signup</button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-4" style="display: block;">
            <div>
                <label for="username" class="block text-lg font-medium text-gray-700">Username</label>
                <input type="text" id="username" name="username"
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter your username" required>
            </div>
            <div>
                <label for="password" class="block text-lg font-medium text-gray-700">Password</label>
                <input type="password" id="login-password" name="password"
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter your password" required>
            </div>
            <div class="flex justify-center">
                <button type="submit"
                    class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Login</button>
            </div>
        </form>

        <!-- Signup Form -->
        <form id="signup-form" class="space-y-4" style="display: none;">
            <div>
                <label for="new-username" class="block text-lg font-medium text-gray-700">Username</label>
                <input type="text" id="new-username" name="new-username"
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Choose a username" required>
            </div>
            <div>
                <label for="new-password" class="block text-lg font-medium text-gray-700">Password</label>
                <input type="password" id="new-password" name="new-password"
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Choose a password" required>
            </div>
            <div>
                <label for="location" class="block text-lg font-medium text-gray-700">Location</label>
                <input type="text" id="location" name="location"
                    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter your location" required>
            </div>
            <div class="flex justify-center">
                <button type="submit"
                    class="w-full bg-green-500 text-white py-2 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500">Signup</button>
            </div>
        </form>

        <!-- Switch to Signup/Login Link -->
        <p class="mt-4 text-center text-gray-600">
            <span id="switch-to-signup" class="text-blue-500 hover:underline cursor-pointer">Don't have an account? Sign
                Up</span>
            <span id="switch-to-login" class="text-blue-500 hover:underline cursor-pointer hidden">Already have an
                account? Login</span>
        </p>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>

    <script>
        // Get DOM elements
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToLogin = document.getElementById('switch-to-login');

        // Event listeners for tab navigation
        loginTab.addEventListener('click', () => {
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            loginTab.classList.add('bg-blue-500', 'text-white');
            signupTab.classList.remove('bg-blue-500', 'text-white');
        });

        signupTab.addEventListener('click', () => {
            signupForm.style.display = 'block';
            loginForm.style.display = 'none';
            signupTab.classList.add('bg-blue-500', 'text-white');
            loginTab.classList.remove('bg-blue-500', 'text-white');
        });

        // Switch to signup view
        switchToSignup.addEventListener('click', () => {
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            loginTab.classList.remove('bg-blue-500', 'text-white');
            signupTab.classList.add('bg-blue-500', 'text-white');
            switchToSignup.style.display = 'none';
            switchToLogin.style.display = 'block';
        });

        // Switch to login view
        switchToLogin.addEventListener('click', () => {
            signupForm.style.display = 'none';
            loginForm.style.display = 'block';
            signupTab.classList.remove('bg-blue-500', 'text-white');
            loginTab.classList.add('bg-blue-500', 'text-white');
            switchToLogin.style.display = 'none';
            switchToSignup.style.display = 'block';
        });

        // Default view: Login
        loginTab.click();

        const loginFormElement = document.getElementById('login-form');
        const signupFormElement = document.getElementById('signup-form');

        loginFormElement.addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const userData = {
                username: formData.get('username'),
                password: formData.get('password')
            };

            fetch("http://localhost:8000/login", {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json' 
                },
                body: JSON.stringify(userData)
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            throw new Error(errorData.message || 'Login failed');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Login successful:', data);
                    window.location.href = 'hc.html';
                })
                .catch(error => {
                    console.error('Error during login:', error.message);
                    alert(error.message);
                });
        });

        signupFormElement.addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const userData = {
                username: formData.get('new-username'),
                password: formData.get('new-password'),
                location: formData.get('location')
            };

            fetch("http://localhost:8000/register", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
                .then(response => {
                    console.log(response, response.ok)
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            throw new Error(errorData.detail || 'Registration failed');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Signup successful:', data);

                    window.location.href = 'hc.html';
                })
                .catch(error => {
                    console.error('Error during Signup:', error.message);
                    alert(error.message); 
                });
        });


    </script>

</body>

</html>